<UserControl x:Class="EZXLightspeedGUI.View.AccountUserControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:vm="clr-namespace:EZXLightspeedGUI.ViewModel"
             xmlns:view="clr-namespace:EZXLightspeedGUI.View"
             xmlns:entity="clr-namespace:EZX.LightSpeedEngine;assembly=LightSpeedEngine"
             xmlns:ezxctrl="clr-namespace:EZXWPFLibrary.CustomControls;assembly=EZXWPFLibrary"
             xmlns:toolKit="http://schemas.microsoft.com/winfx/2006/xaml/presentation/toolkit/extended"
             xmlns:wpfextentions="clr-namespace:EZXWPFLibrary.WPFCustomExtention;assembly=EZXWPFLibrary"
             mc:Ignorable="d" 
             d:DesignHeight="300" d:DesignWidth="300">
    <UserControl.DataContext>
        <vm:AccountUserControlVM/>
    </UserControl.DataContext>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="30"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.Resources>
            <ContextMenu x:Key="treeViewContextMenu" Closed="ContextMenu_Closed"                          >
                <MenuItem Header="Create New Group" Click="CreateGroupMenuItem_Click"/>
                <MenuItem Header="Create Account" Click="CreateAccountGroupMenuItem_Click"/>
            </ContextMenu>
        </Grid.Resources>

        <!--<MenuItem Header="Rename" 
                    Visibility="{Binding Converter={StaticResource NodeTypeToVisibilityConverter}, ConverterParameter=RENGROUP, Path=SelectedItem, ElementName=treeView}"
                    Click="RenameGroupMenuItem_Click" />
        <MenuItem Header="Delete Group" 
                    Visibility="{Binding Converter={StaticResource NodeTypeToVisibilityConverter}, ConverterParameter=DELGROUP, Path=SelectedItem, ElementName=treeView}"
                    Click="DeleteGroupMenuItem_Click" />
        <MenuItem Header="Create Account" 
                    Visibility="{Binding Converter={StaticResource NodeTypeToVisibilityConverter}, ConverterParameter=CREACCOUNT, Path=SelectedItem, ElementName=treeView}"
                    Click="CreateAccountMenuItem_Click" 
                    />
        <MenuItem Header="Delete Account"
                    Visibility="{Binding Converter={StaticResource NodeTypeToVisibilityConverter}, ConverterParameter=DELACCOUNT, Path=SelectedItem, ElementName=treeView}"
                    Click="DeleteAccountMenuItem_Click" />-->

        <Border Grid.Row="0" BorderThickness="1" Background="LightGoldenrodYellow" BorderBrush="{StaticResource NormalBorderBrush}">
            <TextBlock Padding="10,0,5,0" Text="Groups / Accounts List" FontSize="14"  FontWeight="DemiBold"
                       VerticalAlignment="Center" Height="25" Background="{StaticResource NormalBrush}"
                       />
        </Border>
        <ezxctrl:EZXTreeView Grid.Row="1" BorderThickness="0" 
                  ItemsSource="{Binding Path=GUILSEngine.DataManager.AccountGroupList, Source={StaticResource AppManager}}" 
                  HorizontalAlignment="Stretch" VerticalAlignment="Stretch"                  
                  BorderBrush="LightBlue" VerticalContentAlignment="Stretch"
                  ContextMenu="{StaticResource treeViewContextMenu}"          
                  x:Name="treeView"
                  AllowDrop="True" MinHeight="400"
                  SelectedItemChanged="treeView_SelectedItemChanged"            
                  Drop="treeView_Drop" 
                  SelectionCancelled="treeView_SelectionCancelled"
                  wpfextentions:DragDropExtension.ScrollOnDragDrop="True"           
                  PreviewSelectedItemChanged="treeView_PreviewSelectedItemChanged"                             
                  PreviewMouseRightButtonDown="treeView_PreviewMouseRightButtonDown" 
                  >
            <ezxctrl:EZXTreeView.ItemContainerStyle>
                <Style TargetType="{x:Type TreeViewItem}">
                    <EventSetter Event="TreeViewItem.DragEnter" Handler="treeViewItem_DragEnter"/>
                    <EventSetter Event="TreeViewItem.Drop" Handler="treeViewItem_Drop"/>
                    <EventSetter Event="TreeViewItem.MouseMove" Handler="treeViewItem_MouseMove"/>
                    <EventSetter Event="TreeViewItem.DragLeave" Handler="treeViewItem_DragLeave"/>
                    <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
                    <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}" />
                    <EventSetter Event="RequestBringIntoView" Handler="TreeViewItem_RequestBringIntoView"/>
                    <Setter Property="FontWeight" Value="Normal" />
                </Style>
            </ezxctrl:EZXTreeView.ItemContainerStyle>
            <ezxctrl:EZXTreeView.ItemTemplate>
                <HierarchicalDataTemplate ItemsSource="{Binding Path=AccountList}">
                    <StackPanel Margin="2,2,2,2" 
                            DragEnter="StackPanel_DragEnter"
                            DragLeave="StackPanel_DragLeave"
                                >
                        <Border BorderThickness="0" Background="Transparent"
                            DragOver="Border_DragOver" 
                            DragLeave="Border_DragLeave"    
                            AllowDrop="True"
                            Drop="Border_Drop"
                            Visibility="Collapsed" 
                            >
                        <Image Stretch="None" Width="16" Height="8" VerticalAlignment="Center" AllowDrop="True"
                               Source="/EZXAccountRiskGUI;component/Images/Up-icon.png"
                               Margin="10,1,10,1"
                               Drop="Image_DropUp" 
                               Tag="UpIcon"                         
                               />
                        </Border>
                            <StackPanel Orientation="Horizontal" x:Name="stkPnlTreeViewItemTextBlock"
                                    Margin="2,0,2,0"
                                    Visibility="{Binding IsInEditMode, Converter={StaticResource InvertBooleanToVisibilityConverter}}"
                                    MouseLeftButtonDown="stkPnlTreeViewItemTextBlock_MouseLeftButtonDown"
                                    DragOver="TextBlock_DragOver" 
                                    DragLeave="TextBlock_DragLeave"
                                    Drop="StackPanel_Drop"    >
                            <StackPanel.ContextMenu>
                                <ContextMenu x:Name="nodeCntxMnu"
                                         Closed="ContextMenu_Closed" 
                                         Opened="ContextMenu_Opened"                                              
                                         Visibility="{Binding Converter={StaticResource NodeTypeToVisibilityConverter}, ConverterParameter=CONTEXTMENU}" >
                                    <MenuItem Header="Rename" 
                                              Visibility="{Binding Converter={StaticResource NodeTypeToVisibilityConverter}, ConverterParameter=RENGROUP}"
                                              Click="RenameGroupMenuItem_Click" />
                                    <MenuItem Header="Delete Group" 
                                              Visibility="{Binding Converter={StaticResource NodeTypeToVisibilityConverter}, ConverterParameter=DELGROUP}"
                                              Click="DeleteGroupMenuItem_Click" />
                                    <MenuItem Header="Create Account" 
                                              Visibility="{Binding Converter={StaticResource NodeTypeToVisibilityConverter}, ConverterParameter=CREACCOUNT}"
                                              Click="CreateAccountMenuItem_Click" 
                                              Command=""/>
                                    <MenuItem Header="Delete Account"
                                              Visibility="{Binding Converter={StaticResource NodeTypeToVisibilityConverter}, ConverterParameter=DELACCOUNT}"
                                              Click="DeleteAccountMenuItem_Click" />
                                </ContextMenu>
                            </StackPanel.ContextMenu>
                            <Image Stretch="None" Width="16" Height="16" VerticalAlignment="Center" Tag="ImageIcon" Margin="2"
                               Source="{Binding Converter={StaticResource AccountGroupToImageConverter}}"
                               AllowDrop="True" DragEnter="Image_DragEnter"/>
                            <TextBlock Text="{Binding Path=Name}" Margin="5,0,5,0" VerticalAlignment="Center" 
                                   Visibility="{Binding IsInEditMode, Converter={StaticResource InvertBooleanToVisibilityConverter}}" 
                                   TextWrapping="Wrap" MinWidth="100" MaxWidth="200"
                                   AllowDrop="True"  
                                   >
                            </TextBlock>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" 
                                    Margin="2,0,2,0"
                                    Visibility="{Binding IsInEditMode, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <Border Background="White" BorderThickness="1" BorderBrush="Transparent">
                                <TextBox Margin="5,0,5,0" 
                                     Text="{Binding Path=Name, UpdateSourceTrigger=LostFocus}" VerticalAlignment="Center"                                                                           
                                       Focusable="True"                                       
                                       IsEnabled="True" TextWrapping="Wrap" MinWidth="100" MaxWidth="200"
                                       Loaded="TextBox_Loaded"  
                                       IsReadOnly="False" PreviewKeyDown="TextBox_PreviewKeyDown"
                                       PreviewLostKeyboardFocus="TextBox_PreviewLostKeyboardFocus"  
                                       />
                            </Border>
                            <Button Width="25" Content="OK" Height="25" VerticalAlignment="Center" 
                                    Click="SaveGroupAndAccountButton_Click" Visibility="Collapsed"
                                    />
                        </StackPanel>
                    </StackPanel>
                </HierarchicalDataTemplate>
            </ezxctrl:EZXTreeView.ItemTemplate>

        </ezxctrl:EZXTreeView>

    </Grid>
</UserControl>
